<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Client</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f2f5; color: #333; }
        .wrapper {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin: 0 auto;
        }
        .column { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: auto; box-sizing: border-box; height: 90vh;}
        /* Form Styling */
        .field-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input, select, textarea { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; 
        }
        textarea { font-family: monospace; resize: vertical; min-height: 100px; }
        /* Headers Styling */
        .header-row { display: flex; gap: 5px; margin-bottom: 8px; }
        .remove-btn { background: #ff4d4d; color: white; border: none; padding: 0 12px; cursor: pointer; border-radius: 4px; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .add-btn { background: #6c757d; color: white; border: none; padding: 8px; cursor: pointer; border-radius: 4px; }
        .submit-btn { background: #007bff; color: white; border: none; padding: 12px; cursor: pointer; border-radius: 4px; font-size: 1rem; font-weight: bold; }

        /* Output Styling */
        .result-text { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre; min-height: 65vh;}
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-weight: bold; margin-bottom: 10px; }
        .status-ok { background: #d4edda; color: #155724; }
        .status-err { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

    <div class="wrapper">
        <div class="column">
            <h3>Request Configuration</h3>
            <form id="apiForm">
                <div class="btn-group" style="margin-bottom: 15px;">
                    <button type="submit" class="submit-btn">Send Request</button>
                </div>
                <div class="field-group" style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Method</label>
                        <select id="method">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                    </div>
                    <div style="flex: 3;">
                        <label>URL</label>
                        <input type="text" id="apiUrl" value="https://jsonplaceholder.typicode.com/posts">
                    </div>
                </div>

                <label>Headers</label>
                <div id="headersContainer">
                    <div class="header-row">
                        <input type="text" placeholder="Content-Type" class="h-name" value="Content-Type">
                        <input type="text" placeholder="value" class="h-value" value="application/json">
                    </div>
                </div>
                <button type="button" class="add-btn" id="addHeader">+ Add Header</button>

                <div class="field-group" style="margin-top: 15px;">
                    <label>Body (JSON)</label>
                    <textarea id="apiBody" placeholder='{ "title": "foo", "body": "bar", "userId": 1 }'></textarea>
                </div>
            </form>
        </div>

        <div class="column">
            <h3>Response</h3>
            <div id="result">
                <div id="result-status" class="status-badge">
                    Configure your request and hit send...
                </div>
                <textarea id="result-text" class="result-text" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        const container = document.getElementById('headersContainer');
        const addBtn = document.getElementById('addHeader');
        const form = document.getElementById('apiForm');
        // const resultDiv = document.getElementById('result');
        const resultStat = document.getElementById('result-status');
        const resultText = document.getElementById('result-text');

        // Add Header Row logic
        addBtn.addEventListener('click', () => {
            const row = document.createElement('div');
            row.className = 'header-row';
            row.innerHTML = `
                <input type="text" placeholder="Header Name" class="h-name">
                <input type="text" placeholder="Value" class="h-value">
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            container.appendChild(row);
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            // resultDiv.innerHTML = "<em>Sending...</em>";
            resultStat.className = `status-badge`
            resultStat.textContent = "Sending...";

            const url = document.getElementById('apiUrl').value;
            const method = document.getElementById('method').value;
            const bodyContent = document.getElementById('apiBody').value;
            
            // Build Headers
            const myHeaders = new Headers();
            document.querySelectorAll('.header-row').forEach(row => {
                const name = row.querySelector('.h-name').value.trim();
                const value = row.querySelector('.h-value').value.trim();
                if (name) myHeaders.append(name, value);
            });

            // Prepare Request Options
            const options = {
                method: method,
                headers: myHeaders
            };

            // Only add body if it's not a GET/HEAD request
            if (method !== 'GET' && bodyContent.trim() !== '') {
                options.body = bodyContent;
            }

            try {
                const response = await fetch(url, options);
                const rawText = await response.text();
                
                const statusClass = response.ok ? 'status-ok' : 'status-err';
                let resText = rawText
                try{
                    const data = JSON.parse(rawText)
                    resText = JSON.stringify(data, null, 2)
                } catch (jsonErr) {
                    resText = "--- Raw Response (Not JSON) ---\n\n"+rawText;
                }
                
                // resultDiv.innerHTML = `
                //     <div class="status-badge ${statusClass}">
                //         Status: ${response.status} ${response.statusText}
                //     </div>
                //     <textarea class="result-text" readonly>${resText}</textarea>
                // `;
                resultStat.className = `status-badge ${statusClass}`
                resultStat.textContent = `${response.status} ${response.statusText}`;
                resultText.value = resText;
            } catch (err) {
                // resultDiv.innerHTML = `
                //     <div class="status-badge status-err">Error</div>
                //     <textarea class="result-text" readonly>${err.message}</textarea>
                // `;
                resultStat.className = `status-badge status-err`
                resultStat.textContent = "Error";
                resultText.value = err.message;
            }
        });
    </script>
</body>
</html>